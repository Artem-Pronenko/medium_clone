import React, {useEffect, useState, useContext} from 'react'
import {Redirect} from 'react-router-dom'

import ArticleForm from 'components/ArticleForm'
import useFirebaseSet from 'hooks/useFirebaseSet'
import {CurrentUserContext} from 'contexts/currentUser'


const CreateArticle = () => {
  const [{response, error}, dbSet] = useFirebaseSet()
  const [currentUserState] = useContext(CurrentUserContext)
  const initialValue = {
    title: '',
    description: '',
    body: '',
    tagList: []
  }

  const [isSuccessFullSubmit, setIsSuccessFullSubmit] = useState(false)

  const handleSubmit = body => {
    dbSet({url: 'posts', body})
  }

  useEffect(() => {
    response && setIsSuccessFullSubmit(true)
  }, [response])

  if (!currentUserState.isLoggedIn) {
    return <Redirect to={'/'}/>
  }

  if (isSuccessFullSubmit) {
    return <Redirect to={`/articles/${response.uuid}`}/>
  }

  return (
    <div>
      <ArticleForm
        errors={(error && error)}
        initialValue={initialValue}
        onSubmit={handleSubmit}
      />
    </div>
  )
}

export default CreateArticle
