import React, {useEffect} from 'react'

import {getPaginator, limit} from 'utils'
// import {stringify} from 'query-string'
import Loading from 'components/Loading'
import ErrorMessage from 'components/ErrorMessage'
import Feed from 'components/Feed'
import Pagination from 'components/Pagination'
import useFirebase from 'hooks/useFirebase'

// const getApiUrl = ({username, offset, isFavorites}) => {
//   const params = isFavorites
//     ? {limit, offset, favorited: username}
//     : {limit, offset, author: username}
//   return `/articles?${stringify(params)}`
// }

const UserArticles = ({username, isFavorites, location, url, slug}) => {
  //const apiUrl = getApiUrl({username, offset, isFavorites})
  const {currentPage} = getPaginator(location.search)
  const [{response, isLoading, error}, dbGet, dispatch] = useFirebase()

  useEffect(() => {
    dispatch({
      type: 'YOR_FEED',
      payload: slug
    })
    dbGet()
  }, [dbGet])

  return (
    <div>
      {isLoading && <Loading/>}
      {error && <ErrorMessage/>}
      {!isLoading && response && (
        <>
          <Feed posts={response.posts} currentPage={currentPage}/>
          <Pagination
            total={response.countLength}
            limit={limit}
            url={url}
            currentPage={currentPage}
          />
        </>
      )}
    </div>
  )
}

export default UserArticles
