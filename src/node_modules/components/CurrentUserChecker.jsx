import {useEffect, useContext} from 'react'
import useAuthChecker from 'hooks/useAuthChecker'
import {CurrentUserContext} from 'contexts/currentUser'

const CurrentUserChecker = ({children}) => {
  const [response] = useAuthChecker()
  const [state, dispatch] = useContext(CurrentUserContext)

  useEffect(() => {
    if (!state.isLoggedIn) {
      dispatch({type: 'UNAUTHORIZED'})
      return
    }

    dispatch({type: 'LOADING'})
  }, [dispatch])

  useEffect(() => {
    if (!response) return

    dispatch({
      type: 'AUTHORIZED',
      payload: response
    })

  }, [response, dispatch])

  return children
}

export default CurrentUserChecker
